<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>R.Raimundo - Ferramentas Modernas</title>

  <link rel="shortcut icon" href="assets/icon.png" type="image/x-icon" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/b73db7ae32.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>

  <style>
    body { font-family: 'Inter', sans-serif; }

    .animated-gradient {
      background: linear-gradient(270deg,#0b132b,#1c2541,#1a3a6b,#2c3e50,#4a6fa5,#2a6f97,#5bc0be,#4a8ab8,#0197f6,#8db9d8,#3cc3f5);
      background-size: 1000% 1000%;
      animation: gradientAnimation 60s ease infinite;
    }
    @keyframes gradientAnimation {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }

    .image-pulse{animation:pulse 10s ease-in-out infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}

    /* Orçamento A4 */
    #a4-container {
      width: 210mm; height: 297mm;
      margin: auto; padding: 0 15mm 15mm;
      box-sizing: border-box; background: #fff;
      position: relative;
    }
    .header-preto {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100px;
      background: #000; color: #fff;
      border-radius: 0 0 100px 100px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      text-align: center; z-index: 5;
    }
    .header-spacer{height:100px}
    .titulo-silk{font-size:1.4rem;font-weight:700}
    .header-info{font-size:1rem;font-weight:500}
    .watermark-container{
      position:absolute;inset:0;
      background:url("/img/watermarkrraimundo.svg") repeat;
      background-size:900px auto;opacity:.03;
    }
  </style>
</head>

<body class="bg-slate-50 text-gray-800">
  <header class="bg-gray-800 shadow-lg sticky top-0 z-50">
    <nav id="navbar" class="container mx-auto flex items-center justify-between p-2">
      <img src="assets/logo.svg" alt="logo" data-target="home"
        class="w-36 cursor-pointer transition-opacity duration-500 hover:opacity-50"/>
      <div class="flex items-center space-x-2 md:space-x-4">
        <a href="#referencias" data-target="referencias"
          class="text-white text-sm md:text-base py-2 px-3 rounded-lg opacity-75 hover:opacity-100 hover:bg-gray-700/60">Referências</a>
        <a href="#pdf" data-target="pdf"
          class="text-white text-sm md:text-base py-2 px-3 rounded-lg opacity-75 hover:opacity-100 hover:bg-gray-700/60">PDF</a>
        <a href="#desenvolvimento" data-target="desenvolvimento"
          class="text-white text-sm md:text-base py-2 px-3 rounded-lg opacity-75 hover:opacity-100 hover:bg-gray-700/60">Desenvolvimento</a>
      </div>
    </nav>
  </header>

  <main>
    <!-- Home -->
    <section id="home" class="content">
      <div class="animated-gradient h-[calc(100vh-60px)] flex flex-col justify-center items-center">
        <div class="bg-[url('assets/background.svg')] bg-cover w-full h-full flex flex-col justify-center items-center opacity-40">
          <img src="assets/logo.svg" alt="logo" class="h-24 image-pulse mb-4"/>
          <h1 class="text-white text-2xl md:text-3xl font-light tracking-wide text-center">
            Olá, Seja bem-vindo às Ferramentas da R. Raimundo
          </h1>
        </div>
      </div>
    </section>

    <div class="container mx-auto px-4">
<section id="referencias" class="content hidden">
   <div class="bg-white rounded-lg shadow-xl max-w-4xl mx-auto my-8 p-6 md:p-8 flex flex-col items-center" >
      <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-700 mb-2" > Gerador de Referências </h1>
      <p class="text-center text-gray-500 mb-6"> Digite suas referências no formato especificado e clique em "Gerar". </p>
      <textarea id="referencesInput" rows="10" placeholder="Exemplo: MX-137/A (37-43)" class="w-full max-w-2xl p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" ></textarea>
      <button id="generateReferencesBtn" class="mt-4 w-full md:w-auto inline-flex items-center justify-center font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-blue-600 hover:bg-blue-700 text-white focus:ring-blue-500" > <i class="fa-solid fa-circle-plus mr-2"></i>Gerar Referências </button> 
      <div class="w-full mt-6">
         <div class="flex justify-between items-center mb-2">
            <h2 class="text-xl font-semibold">Referências Geradas:</h2>
            <button id="copyBtn" class="inline-flex items-center justify-center font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-gray-600 hover:bg-gray-700 text-white focus:ring-gray-500" > <i class="fa-solid fa-clone mr-2"></i>Copiar </button> 
         </div>
         <div id="output" class="mt-4 p-4 w-full border border-gray-200 rounded-md bg-gray-50 min-h-[100px] whitespace-pre-wrap font-mono text-sm" ></div>
      </div>
   </div>
</section>
<div class="container mx-auto px-4">

      <!-- PDF -->
      <section id="pdf" class="content hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl mx-auto my-8 p-6 md:p-8 flex flex-col items-center">
          <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-700 mb-2">Junte Seus PDF's Aqui</h1>
          <form id="pdfForm" class="w-full flex flex-col items-center">
            <input type="file" id="pdfFiles" multiple accept="application/pdf"
              class="block w-full max-w-md text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full
                     file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/>
            <button type="submit"
              class="mt-4 inline-flex items-center justify-center font-bold py-2 px-4 rounded-lg shadow-md
                     bg-blue-600 hover:bg-blue-700 text-white focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              <i class="fa-solid fa-wand-magic-sparkles mr-2"></i>Mesclar PDFs
            </button>
          </form>
          <div id="result" class="w-full mt-6"></div>
        </div>
      </section>

      <!-- Desenvolvimento -->
      <section id="desenvolvimento" class="content hidden">
        <div class="max-w-3xl mx-auto bg-white shadow-lg rounded-xl p-8">
          <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-700 mb-2">Novo Orçamento</h1>

          <form id="budget-form" class="grid grid-cols-1 md:grid-cols-2 gap-6 justify-items-center">
            <div class="w-full max-w-[340px]">
              <label class="block mb-1 font-semibold text-gray-700">Silk</label>
              <input type="text" id="silk"
                class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500"
                placeholder="Ex: Jorge Bischoff" required/>
            </div>
            <div class="w-full max-w-[340px]">
              <label class="block mb-1 font-semibold text-gray-700">Cliente</label>
              <input type="text" id="cliente"
                class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500"
                placeholder="Ex: Albanese" required/>
            </div>

            <div class="w-full max-w-[340px]">
              <label class="block mb-1 font-semibold text-gray-700">Matriz Serigráfica (R$)</label>
              <input type="number" id="matriz-valor" value="70" step="0.01"
                class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500" required/>
            </div>
            <div class="w-full max-w-[340px]">
              <label class="block mb-1 font-semibold text-gray-700">Qtd. Matriz</label>
              <input type="number" id="matriz-qtd" value="1"
                class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500" required/>
            </div>

            <div class="w-full max-w-[340px]">
              <label class="block mb-1 font-semibold text-gray-700">Gravação + Fotolito (R$)</label>
              <input type="number" id="gravacao-valor" value="10" step="0.01"
                class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500" required/>
            </div>
            <div class="w-full max-w-[340px]">
              <label class="block mb-1 font-semibold text-gray-700">Qtd. Gravação</label>
              <input type="number" id="gravacao-qtd" value="1"
                class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500" required/>
            </div>

            <div class="w-full max-w-[340px]">
              <label class="block mb-2 font-semibold text-gray-700">Unidade de medida</label>
              <div id="unidade-group" class="flex gap-3">
                <button type="button" data-unidade="Par"
                  class="px-4 py-2 rounded-lg border bg-blue-600 text-white shadow hover:bg-blue-700 transition">Par</button>
                <button type="button" data-unidade="Metro"
                  class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition">Metro</button>
                <button type="button" data-unidade="Unidade"
                  class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition">Unidade</button>
              </div>
            </div>
            <div class="w-full max-w-[340px]">
              <label class="block mb-1 font-semibold text-gray-700">Imagem do Desenvolvimento</label>
              <input type="file" id="imagem-desenvolvimento" accept="image/*"
                class="block w-full text-sm text-slate-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg
                       file:border-0 file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 cursor-pointer"/>
            </div>

            <div class="w-full max-w-[340px] md:col-span-2">
              <label class="block mb-1 font-semibold text-gray-700">Valor por <span id="label-unidade">Par</span> (R$)</label>
              <input type="number" id="valor-par" value="1.20" step="0.01"
                class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500" required/>
            </div>

            <div class="md:col-span-2 flex justify-center gap-4 mt-4">
              <button type="submit"
                class="inline-flex items-center justify-center font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-gray-600 hover:bg-gray-700 text-white focus:ring-gray-500">
                Gerar Orçamento
              </button>
              <button id="download-pdf" disabled
                class="inline-flex items-center justify-center font-bold py-2 px-4 rounded-lg shadow-md
                       bg-gray-400 text-white opacity-60 cursor-not-allowed">
                📄 Baixar PDF
              </button>
            </div>
          </form>
        </div>
      </section>

      <!-- Documento Orçamento -->
      <section id="document-section" class="content hidden">
        <div id="a4-container">
          <div class="header-preto">
            <h2 class="titulo-silk" id="doc-silk">SILK</h2>
            <p class="header-info" id="doc-cliente">CLIENTE</p>
            <p class="header-info" id="doc-data">DATA</p>
          </div>
          <div class="header-spacer"></div>
          <div class="p-6">
            <h3 class="font-bold text-lg mb-2">Custos de Desenvolvimento</h3>
            <table class="w-full text-left border-collapse mb-4">
              <thead><tr class="border-b">
                <th class="py-2">Item</th><th class="py-2">Valor Unit.</th>
                <th class="py-2">Qtd</th><th class="py-2">Total</th>
              </tr></thead>
              <tbody>
                <tr><td>Matriz Serigráfica</td><td id="doc-matriz-valor"></td><td id="doc-matriz-qtd"></td><td id="doc-matriz-total"></td></tr>
                <tr><td>Gravação + Fotolito</td><td id="doc-gravacao-valor"></td><td id="doc-gravacao-qtd"></td><td id="doc-gravacao-total"></td></tr>
                <tr class="font-bold border-t"><td colspan="3">Total Desenvolvimento</td><td id="doc-desenvolvimento-total" class="font-bold"></td></tr>
              </tbody>
            </table>
            <p id="doc-valor-par-label" class="mt-4 font-semibold">Valor por Par estampado:
              <span id="doc-valor-par"></span></p>
            <div class="mt-6"><img id="doc-imagem" class="max-h-64 mx-auto"/></div>
          </div>
          <div class="watermark-container"></div>
        </div>
      </section>

    </div>
  </main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const navbar=document.getElementById('navbar');
  const contents=document.querySelectorAll('.content');
  navbar.addEventListener('click', e=>{
    if(e.target.matches('a, img')&&e.target.dataset.target){
      e.preventDefault(); showContent(e.target.dataset.target);
    }
  });
  function showContent(id){
    contents.forEach(c=>c.classList.add('hidden'));
    document.getElementById(id)?.classList.remove('hidden');
  }
  showContent('home');

  // Mesclar PDFs
  document.getElementById("pdfForm").addEventListener("submit",async ev=>{
    ev.preventDefault();
    const files=document.getElementById("pdfFiles").files;
    if(files.length<2){alert("Selecione pelo menos 2 PDFs.");return;}
    const pdfDoc=await PDFLib.PDFDocument.create();
    for(const file of files){
      const bytes=await file.arrayBuffer();
      const doc=await PDFLib.PDFDocument.load(bytes);
      const pages=await pdfDoc.copyPages(doc,doc.getPageIndices());
      pages.forEach(p=>pdfDoc.addPage(p));
    }
    const pdfBytes=await pdfDoc.save();
    const uri=URL.createObjectURL(new Blob([pdfBytes],{type:"application/pdf"}));
    document.getElementById("result").innerHTML=`
      <div class="w-full flex justify-center mb-4">
        <a href="${uri}" download="pdf-mesclado.pdf"
           class="inline-flex items-center justify-center font-bold py-2 px-4 rounded-lg shadow-md
                  bg-green-600 hover:bg-green-700 text-white focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
          <i class="fa-solid fa-download mr-2"></i>Baixar PDF Mesclado
        </a>
      </div>
      <iframe src="${uri}" class="w-full h-[600px] border rounded-md"></iframe>`;
  });

  // --- Orçamento ---
  let unidadeSelecionada="Par";
  document.querySelectorAll("#unidade-group button").forEach(btn=>{
    btn.addEventListener("click",()=>{
      unidadeSelecionada=btn.dataset.unidade;
      document.querySelectorAll("#unidade-group button")
        .forEach(b=>b.classList.remove("bg-blue-600","text-white","shadow"));
      btn.classList.add("bg-blue-600","text-white","shadow");
      const sufixo=(unidadeSelecionada==="Unidade")?"estampada":"estampado";
      document.getElementById("label-unidade").textContent=unidadeSelecionada;
      document.getElementById("doc-valor-par-label").textContent=`Valor por ${unidadeSelecionada} ${sufixo}:`;
    });
  });

  document.getElementById("budget-form").addEventListener("submit",e=>{
    e.preventDefault();
    const silk=document.getElementById("silk").value.trim();
    const cliente=document.getElementById("cliente").value.trim();
    const dataHoje=new Date().toLocaleDateString("pt-BR");
    const mv=parseFloat(document.getElementById("matriz-valor").value);
    const mq=parseInt(document.getElementById("matriz-qtd").value);
    const mt=mv*mq;
    const gv=parseFloat(document.getElementById("gravacao-valor").value);
    const gq=parseInt(document.getElementById("gravacao-qtd").value);
    const gt=gv*gq;
    const devTotal=mt+gt;
    const vp=parseFloat(document.getElementById("valor-par").value);

    document.getElementById("doc-silk").textContent=silk;
    document.getElementById("doc-cliente").textContent=cliente;
    document.getElementById("doc-data").textContent=dataHoje;
    document.getElementById("doc-matriz-valor").textContent="R$ "+mv.toFixed(2);
    document.getElementById("doc-matriz-qtd").textContent=mq;
    document.getElementById("doc-matriz-total").textContent="R$ "+mt.toFixed(2);
    document.getElementById("doc-gravacao-valor").textContent="R$ "+gv.toFixed(2);
    document.getElementById("doc-gravacao-qtd").textContent=gq;
    document.getElementById("doc-gravacao-total").textContent="R$ "+gt.toFixed(2);
    document.getElementById("doc-desenvolvimento-total").innerHTML=`<strong>R$ ${devTotal.toFixed(2)}</strong>`;
    document.getElementById("doc-valor-par").textContent="R$ "+vp.toFixed(2);

    const fileInput=document.getElementById("imagem-desenvolvimento");
    if(fileInput.files&&fileInput.files[0]){
      const reader=new FileReader();
      reader.onload=e=>document.getElementById("doc-imagem").src=e.target.result;
      reader.readAsDataURL(fileInput.files[0]);
    }

    document.getElementById("document-section").classList.remove("hidden");
    const downloadBtn=document.getElementById("download-pdf");
    downloadBtn.disabled=false;
    downloadBtn.classList.remove("bg-gray-400","opacity-60","cursor-not-allowed");
    downloadBtn.classList.add("bg-green-600","hover:bg-green-700");
  });

  document.getElementById("download-pdf").addEventListener("click",async ()=>{
    const silk=document.getElementById("silk").value.trim().replace(/\s+/g,"_");
    const cliente=document.getElementById("cliente").value.trim().replace(/\s+/g,"_");
    const dataHoje=new Date().toLocaleDateString("pt-BR").replace(/\//g,"-");
    const fileName=`Orcamento-${silk}(${cliente})-${dataHoje}.pdf`;

    const {jsPDF}=window.jspdf;
    const element=document.getElementById("a4-container");
    const canvas=await html2canvas(element,{scale:3,useCORS:true});
    const imgData=canvas.toDataURL("image/png",1.0);
    const pdf=new jsPDF("p","mm","a4");
    const pageWidth=210;
    const imgProps=pdf.getImageProperties(imgData);
    const imgHeight=(imgProps.height*pageWidth)/imgProps.width;
    pdf.addImage(imgData,"PNG",0,0,pageWidth,imgHeight,null,"FAST");
    pdf.save(fileName);
  });
});
</script>
</body>
</html>
